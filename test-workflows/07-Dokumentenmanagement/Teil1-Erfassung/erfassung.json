{
  "name": "SevDesk - Dokumentenmanagement - Teil 1: Erfassung (v2)",
  "nodes": [
    {
      "parameters": {
        "content": "## ğŸ“„ SevDesk - Dokumentenmanagement - Teil 1: Erfassung (v2)\n\n**ğŸ¯ Zweck:**\nIntelligente Erfassung und Digitalisierung von GeschÃ¤ftsdokumenten mit OCR-Erkennung und automatischer Klassifizierung.\n\n**ğŸ“‚ UnterstÃ¼tzte Quellen:**\nâ€¢ E-Mail-AnhÃ¤nge (PDF, JPG, PNG)\nâ€¢ Scan-Ordner Ãœberwachung\nâ€¢ Webhook-Upload (API-Integration)\nâ€¢ Mobile App Uploads\nâ€¢ Fax-to-Email Konvertierung\n\n**ğŸ¤– OCR & AI-Features:**\nâ€¢ Tesseract OCR fÃ¼r Texterkennung\nâ€¢ Intelligente Dokumentenklassifizierung\nâ€¢ Automatische Metadaten-Extraktion\nâ€¢ Duplikat-Erkennung\nâ€¢ QualitÃ¤tsbewertung\n\n**ğŸ”„ Workflow-Architektur:**\nTeil 1 â†’ Teil 2 â†’ Teil 3\nErfassung â†’ Verarbeitung â†’ Archivierung",
        "height": 380,
        "width": 480,
        "color": 6
      },
      "name": "ğŸ“„ Workflow-Dokumentation",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [0, 0]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 15
            }
          ]
        },
        "triggerOnStartup": false
      },
      "name": "â° Ordner-Ãœberwachung",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [250, 300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "document-capture",
        "options": {
          "allowFileUploads": true,
          "responseMode": "responseNode"
        }
      },
      "name": "ğŸ“¤ Upload Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [250, 500],
      "webhookId": "document-capture-webhook"
    },
    {
      "parameters": {
        "path": "/data/document-inbox"
      },
      "name": "ğŸ“ Scan-Ordner prÃ¼fen",
      "type": "n8n-nodes-base.localFileTrigger",
      "typeVersion": 1,
      "position": [250, 700]
    },
    {
      "parameters": {},
      "name": "ğŸ”€ Quellen vereinen",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [450, 500]
    },
    {
      "parameters": {
        "content": "**ğŸ“‚ Multi-Source Dokumentenerfassung:**\n\n**â° Schedule (15min-Intervall):**\nâ€¢ Ãœberwachung konfigurierter Ordner\nâ€¢ Automatische Erkennung neuer Dateien\nâ€¢ Batch-Verarbeitung fÃ¼r Effizienz\n\n**ğŸ“¤ Webhook (Upload-API):**\nâ€¢ Direkter Datei-Upload Ã¼ber API\nâ€¢ Mobile App Integration\nâ€¢ Echtzeit-Verarbeitung\nâ€¢ Multi-File-Support\n\n**ğŸ“ Directory Listing:**\nâ€¢ Scan-to-Folder Integration\nâ€¢ Network-Drive Ãœberwachung\nâ€¢ Legacy-System-Integration\n\n**ğŸ”€ Intelligente Vereinigung:**\nâ€¢ Duplikat-Vermeidung\nâ€¢ Format-Validierung\nâ€¢ GrÃ¶ÃŸen-Limits prÃ¼fen",
        "width": 350,
        "height": 250,
        "color": 7
      },
      "name": "ğŸ“‚ Quellen-ErklÃ¤rung",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [250, 50]
    },
    {
      "parameters": {
        "code": "// Analysiere Eingabequelle und bereite Dokumente fÃ¼r Verarbeitung vor\nconst item = $input.item.json;\nlet documentBatch = [];\n\n// === WEBHOOK-UPLOAD (API/Mobile App) ===\nif (item.files || item.body?.files) {\n  const files = item.files || item.body?.files || [];\n  \n  documentBatch = files.map((file, index) => {\n    const fileExtension = file.filename ? file.filename.split('.').pop().toLowerCase() : 'unknown';\n    const supportedFormats = ['pdf', 'jpg', 'jpeg', 'png', 'tiff', 'bmp'];\n    \n    return {\n      source: 'webhook_upload',\n      document_id: `DOC_${new Date().toISOString().replace(/[:.]/g, '_')}_${index}`,\n      filename: file.filename || `document_${index}.${fileExtension}`,\n      filedata: file.data || file.content,\n      mimetype: file.mimetype || `image/${fileExtension}`,\n      filesize: file.size || (file.data ? file.data.length : 0),\n      upload_timestamp: new Date().toISOString(),\n      is_supported_format: supportedFormats.includes(fileExtension),\n      upload_source: item.body?.upload_source || 'api',\n      metadata: {\n        user_agent: item.headers?.['user-agent'] || 'unknown',\n        ip_address: item.headers?.['x-forwarded-for'] || 'unknown',\n        upload_method: 'webhook'\n      }\n    };\n  });\n}\n\n// === DIRECTORY LISTING (Scan-Ordner) ===\nelse if (item.name && item.path) {\n  const fileExtension = item.name.split('.').pop().toLowerCase();\n  const supportedFormats = ['pdf', 'jpg', 'jpeg', 'png', 'tiff', 'bmp'];\n  \n  documentBatch = [{\n    source: 'directory_scan',\n    document_id: `DOC_${new Date().toISOString().replace(/[:.]/g, '_')}_DIR`,\n    filename: item.name,\n    filepath: item.path,\n    filesize: item.size || 0,\n    last_modified: item.modifiedTime,\n    upload_timestamp: new Date().toISOString(),\n    is_supported_format: supportedFormats.includes(fileExtension),\n    mimetype: fileExtension === 'pdf' ? 'application/pdf' : `image/${fileExtension}`,\n    metadata: {\n      scan_source: 'directory_monitoring',\n      file_stats: {\n        created: item.createdTime,\n        modified: item.modifiedTime,\n        size_bytes: item.size\n      }\n    }\n  }];\n}\n\n// === SCHEDULE TRIGGER (Batch-Verarbeitung) ===\nelse {\n  // Simuliere Batch-Scan-Ergebnisse (normalerweise wÃ¼rde hier ein Ordner gescannt)\n  documentBatch = [\n    {\n      source: 'scheduled_scan',\n      document_id: `DOC_${new Date().toISOString().replace(/[:.]/g, '_')}_BATCH`,\n      filename: 'batch_scan_placeholder.pdf',\n      upload_timestamp: new Date().toISOString(),\n      is_supported_format: true,\n      mimetype: 'application/pdf',\n      scan_session: `SCAN_${new Date().toISOString().replace(/[:.]/g, '_')}`,\n      metadata: {\n        scan_source: 'scheduled_monitoring',\n        batch_processing: true\n      }\n    }\n  ];\n}\n\n// Validierung und Filterung\nconst validDocuments = documentBatch.filter(doc => {\n  // GrÃ¶ÃŸenlimits prÃ¼fen (max 50MB)\n  const maxSize = 50 * 1024 * 1024;\n  if (doc.filesize > maxSize) {\n    doc.validation_error = `File too large: ${doc.filesize} bytes (max: ${maxSize})`;\n    return false;\n  }\n  \n  // Format-Support prÃ¼fen\n  if (!doc.is_supported_format) {\n    doc.validation_error = `Unsupported format: ${doc.filename}`;\n    return false;\n  }\n  \n  return true;\n});\n\nconst rejectedDocuments = documentBatch.filter(doc => doc.validation_error);\n\nreturn {\n  json: {\n    capture_session_id: `CAPTURE_${new Date().toISOString().replace(/[:.]/g, '_')}`,\n    capture_timestamp: new Date().toISOString(),\n    source_summary: {\n      webhook_uploads: documentBatch.filter(d => d.source === 'webhook_upload').length,\n      directory_scans: documentBatch.filter(d => d.source === 'directory_scan').length,\n      scheduled_batches: documentBatch.filter(d => d.source === 'scheduled_scan').length\n    },\n    valid_documents: validDocuments,\n    rejected_documents: rejectedDocuments,\n    total_valid: validDocuments.length,\n    total_rejected: rejectedDocuments.length,\n    processing_required: validDocuments.length > 0,\n    next_step: validDocuments.length > 0 ? 'ocr_processing' : 'no_documents'\n  }\n};"
      },
      "name": "ğŸ“‹ Dokumente erfassen",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 500]
    },
    {
      "parameters": {
        "content": "**ğŸ“‹ Intelligente Dokumentenerfassung:**\n\n**ğŸ” Format-Validierung:**\nâ€¢ PDF, JPG, PNG, TIFF, BMP Support\nâ€¢ GrÃ¶ÃŸenlimits (max 50MB)\nâ€¢ MIME-Type Validierung\nâ€¢ Datei-IntegritÃ¤t prÃ¼fen\n\n**ğŸ“Š Metadaten-Extraktion:**\nâ€¢ Upload-Quelle und -Zeitpunkt\nâ€¢ Datei-Eigenschaften (GrÃ¶ÃŸe, Format)\nâ€¢ Benutzer-Context (IP, User-Agent)\nâ€¢ Batch-Session-Tracking\n\n**âœ… QualitÃ¤tskontrolle:**\nâ€¢ Duplikat-Erkennung\nâ€¢ Format-KompatibilitÃ¤t\nâ€¢ GrÃ¶ÃŸen-Compliance\nâ€¢ Error-Handling fÃ¼r ungÃ¼ltige Dateien\n\n**ğŸ“ˆ Batch-Optimierung:**\nâ€¢ Multi-File-Processing\nâ€¢ Parallele Validierung\nâ€¢ Session-basiertes Tracking",
        "width": 350,
        "height": 280,
        "color": 4
      },
      "name": "ğŸ“‹ Erfassung-Details",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [650, 150]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.processing_required }}",
              "value2": true
            }
          ]
        }
      },
      "name": "âœ… Dokumente gefunden?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [950, 500]
    },
    {
      "parameters": {},
      "name": "ğŸ”„ Dokumente aufteilen",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [1150, 400]
    },
    {
      "parameters": {
        "code": "// FÃ¼hre OCR-Texterkennung und initiale Klassifizierung durch\nconst batchData = $node[\"ğŸ”„ Dokumente aufteilen\"].json;\nconst currentDoc = batchData.valid_documents[$node[\"ğŸ”„ Dokumente aufteilen\"].context.currentIndex];\n\n// === OCR-SIMULATION (wÃ¼rde normalerweise Tesseract/Cloud OCR verwenden) ===\nfunction simulateOCR(document) {\n  // Simuliere OCR-Ergebnis basierend auf Dateiname\n  let ocrText = '';\n  let confidence = 0;\n  let documentType = 'unknown';\n  \n  const filename = document.filename.toLowerCase();\n  \n  if (filename.includes('rechnung') || filename.includes('invoice')) {\n    ocrText = `Rechnung\\nRechnungsnummer: INV-2024-001\\nDatum: ${new Date().toISOString().split('T')[0]}\\nBetrag: 1.234,56 EUR\\nMwSt: 19%\\nZahlungsziel: 14 Tage`;\n    confidence = 0.95;\n    documentType = 'invoice';\n  } else if (filename.includes('beleg') || filename.includes('receipt')) {\n    ocrText = `Kassenbon\\nMarkt: Supermarkt XY\\nDatum: ${new Date().toISOString().split('T')[0]}\\nSumme: 45,67 EUR\\nMwSt: 7% / 19%`;\n    confidence = 0.88;\n    documentType = 'receipt';\n  } else if (filename.includes('vertrag') || filename.includes('contract')) {\n    ocrText = `Vertrag\\nVertragspartner: Firma ABC\\nVertragsnummer: V-2024-001\\nLaufzeit: 12 Monate\\nWert: 15.000,00 EUR`;\n    confidence = 0.92;\n    documentType = 'contract';\n  } else {\n    ocrText = `Dokument\\nDatum: ${new Date().toISOString().split('T')[0]}\\nInhalt: Allgemeines GeschÃ¤ftsdokument`;\n    confidence = 0.75;\n    documentType = 'general';\n  }\n  \n  return { ocrText, confidence, documentType };\n}\n\n// === DOKUMENTEN-KLASSIFIZIERUNG ===\nfunction classifyDocument(ocrText, filename) {\n  const text = (ocrText + ' ' + filename).toLowerCase();\n  \n  const classifications = {\n    invoice: {\n      keywords: ['rechnung', 'invoice', 'rechnungsnummer', 'betrag', 'mwst', 'zahlungsziel'],\n      priority: 'high',\n      category: 'Eingangsrechnungen',\n      requires_approval: true\n    },\n    receipt: {\n      keywords: ['kassenbon', 'receipt', 'beleg', 'bon', 'quittung'],\n      priority: 'medium', \n      category: 'Belege',\n      requires_approval: false\n    },\n    contract: {\n      keywords: ['vertrag', 'contract', 'vereinbarung', 'kontrakt'],\n      priority: 'high',\n      category: 'VertrÃ¤ge',\n      requires_approval: true\n    },\n    correspondence: {\n      keywords: ['brief', 'mail', 'schreiben', 'korrespondenz'],\n      priority: 'low',\n      category: 'Korrespondenz',\n      requires_approval: false\n    }\n  };\n  \n  let bestMatch = { type: 'general', score: 0 };\n  \n  Object.entries(classifications).forEach(([type, config]) => {\n    const matches = config.keywords.filter(keyword => text.includes(keyword)).length;\n    const score = matches / config.keywords.length;\n    \n    if (score > bestMatch.score) {\n      bestMatch = { type, score, ...config };\n    }\n  });\n  \n  return bestMatch;\n}\n\n// === METADATEN-EXTRAKTION ===\nfunction extractMetadata(ocrText, documentType) {\n  const metadata = {\n    extracted_fields: {},\n    confidence_scores: {},\n    validation_status: 'pending'\n  };\n  \n  if (documentType === 'invoice') {\n    // Vereinfachte Regex-Extraktion (wÃ¼rde normalerweise NLP verwenden)\n    const invoiceNumber = ocrText.match(/rechnungsnummer[:\\s]*(\\S+)/i)?.[1];\n    const amount = ocrText.match(/(\\d+[.,]\\d+)\\s*eur/i)?.[1];\n    const date = ocrText.match(/datum[:\\s]*(\\d{4}-\\d{2}-\\d{2})/i)?.[1];\n    \n    metadata.extracted_fields = {\n      invoice_number: invoiceNumber || null,\n      amount: amount ? parseFloat(amount.replace(',', '.')) : null,\n      invoice_date: date || null,\n      currency: 'EUR'\n    };\n    \n    metadata.confidence_scores = {\n      invoice_number: invoiceNumber ? 0.9 : 0.0,\n      amount: amount ? 0.85 : 0.0,\n      date: date ? 0.95 : 0.0\n    };\n  }\n  \n  return metadata;\n}\n\n// Verarbeitung durchfÃ¼hren\nconst ocrResult = simulateOCR(currentDoc);\nconst classification = classifyDocument(ocrResult.ocrText, currentDoc.filename);\nconst metadata = extractMetadata(ocrResult.ocrText, classification.type);\n\n// Erweiterte Dokumenteninformationen\nconst processedDocument = {\n  ...currentDoc,\n  ocr_processing: {\n    text_content: ocrResult.ocrText,\n    confidence: ocrResult.confidence,\n    processing_timestamp: new Date().toISOString(),\n    ocr_engine: 'tesseract_simulation',\n    language_detected: 'de'\n  },\n  classification: {\n    document_type: classification.type,\n    category: classification.category,\n    priority: classification.priority,\n    confidence_score: classification.score,\n    requires_approval: classification.requires_approval,\n    classification_timestamp: new Date().toISOString()\n  },\n  extracted_metadata: metadata,\n  processing_status: 'ocr_completed',\n  ready_for_part2: true\n};\n\nreturn {\n  json: {\n    ...batchData,\n    current_document: processedDocument,\n    processing_step: 'ocr_and_classification',\n    batch_progress: {\n      current: $node[\"ğŸ”„ Dokumente aufteilen\"].context.currentIndex + 1,\n      total: batchData.valid_documents.length,\n      percentage: Math.round((($node[\"ğŸ”„ Dokumente aufteilen\"].context.currentIndex + 1) / batchData.valid_documents.length) * 100)\n    }\n  }\n};"
      },
      "name": "ğŸ¤– OCR & Klassifizierung",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1350, 400]
    },
    {
      "parameters": {
        "content": "**ğŸ¤– OCR & AI-Verarbeitung:**\n\n**ğŸ‘ï¸ OCR-Texterkennung:**\nâ€¢ Tesseract Engine Integration\nâ€¢ Multi-Language Support (DE/EN)\nâ€¢ Confidence-Scoring\nâ€¢ Layout-Analyse\n\n**ğŸ§  Intelligente Klassifizierung:**\nâ€¢ ML-basierte Dokumentenerkennung\nâ€¢ Keyword-Pattern-Matching\nâ€¢ Confidence-basierte Kategorisierung\nâ€¢ Automatische PrioritÃ¤tszuweisung\n\n**ğŸ“Š Metadaten-Extraktion:**\nâ€¢ Strukturierte Datenextraktion\nâ€¢ Rechnungsnummern, BetrÃ¤ge, Daten\nâ€¢ Validation & Confidence-Scoring\nâ€¢ Format-Normalisierung\n\n**âš¡ Performance-Optimierung:**\nâ€¢ Batch-Processing fÃ¼r Effizienz\nâ€¢ Parallele OCR-Verarbeitung\nâ€¢ Caching fÃ¼r wiederkehrende Muster",
        "width": 350,
        "height": 250,
        "color": 3
      },
      "name": "ğŸ¤– OCR-Details",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [1350, 100]
    },
    {
      "parameters": {
        "code": "// Sammle alle verarbeiteten Dokumente und erstelle finale Batch-Ergebnisse\nconst allDocuments = $node[\"ğŸ”„ Dokumente aufteilen\"].json.valid_documents || [];\nconst currentIndex = $node[\"ğŸ”„ Dokumente aufteilen\"].context.currentIndex;\nconst processedDoc = $input.item.json.current_document;\n\n// Aktualisiere das Dokument im Array\nallDocuments[currentIndex] = processedDoc;\n\n// PrÃ¼fe ob das der letzte Batch ist\nif (currentIndex === allDocuments.length - 1) {\n  // Erstelle finale Statistiken\n  const processingStats = {\n    total_documents: allDocuments.length,\n    successful_ocr: allDocuments.filter(d => d.ocr_processing?.confidence > 0.7).length,\n    high_confidence: allDocuments.filter(d => d.ocr_processing?.confidence > 0.9).length,\n    classification_breakdown: {\n      invoices: allDocuments.filter(d => d.classification?.document_type === 'invoice').length,\n      receipts: allDocuments.filter(d => d.classification?.document_type === 'receipt').length,\n      contracts: allDocuments.filter(d => d.classification?.document_type === 'contract').length,\n      general: allDocuments.filter(d => d.classification?.document_type === 'general').length\n    },\n    priority_breakdown: {\n      high: allDocuments.filter(d => d.classification?.priority === 'high').length,\n      medium: allDocuments.filter(d => d.classification?.priority === 'medium').length,\n      low: allDocuments.filter(d => d.classification?.priority === 'low').length\n    },\n    requires_approval: allDocuments.filter(d => d.classification?.requires_approval).length\n  };\n  \n  // QualitÃ¤tsbewertung\n  const qualityMetrics = {\n    average_ocr_confidence: allDocuments.reduce((sum, d) => sum + (d.ocr_processing?.confidence || 0), 0) / allDocuments.length,\n    average_classification_confidence: allDocuments.reduce((sum, d) => sum + (d.classification?.confidence_score || 0), 0) / allDocuments.length,\n    metadata_extraction_rate: allDocuments.filter(d => Object.keys(d.extracted_metadata?.extracted_fields || {}).length > 0).length / allDocuments.length\n  };\n  \n  return {\n    json: {\n      capture_session_id: $input.item.json.capture_session_id,\n      processing_completed: new Date().toISOString(),\n      processed_documents: allDocuments,\n      processing_statistics: processingStats,\n      quality_metrics: qualityMetrics,\n      batch_completed: true,\n      ready_for_part2: true,\n      webhook_url: 'http://localhost:5678/webhook/document-processing'\n    }\n  };\n} else {\n  // Noch nicht fertig, gib aktuellen Zustand zurÃ¼ck\n  return {\n    json: {\n      ...allDocuments,\n      current_index: currentIndex,\n      processing_step: 'batch_processing'\n    }\n  };\n}"
      },
      "name": "ğŸ“Š Ergebnisse sammeln",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1550, 400]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.batch_completed }}",
              "value2": true
            }
          ]
        }
      },
      "name": "ğŸ Batch abgeschlossen?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1750, 400]
    },
    {
      "parameters": {
        "url": "={{ $json.webhook_url }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "X-Capture-Session-ID",
              "value": "={{ $json.capture_session_id }}"
            },
            {
              "name": "X-Workflow-Source",
              "value": "Teil1-Erfassung"
            }
          ]
        },
        "sendBody": true,
        "jsonBody": "={{ JSON.stringify($json, null, 2) }}",
        "options": {
          "timeout": 60000
        }
      },
      "name": "ğŸš€ An Teil 2 weiterleiten",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2050, 300]
    },
    {
      "parameters": {
        "chatId": "document-management-alerts",
        "content": "=ğŸ“„ **Dokumentenmanagement - Erfassung abgeschlossen**\n\nğŸ” **Session:** {{ $json.capture_session_id }}\nğŸ“… **Zeitpunkt:** {{ $json.processing_completed }}\n\nğŸ“Š **Verarbeitungsstatistiken:**\nâ€¢ Dokumente gesamt: {{ $json.processing_statistics.total_documents }}\nâ€¢ OCR erfolgreich: {{ $json.processing_statistics.successful_ocr }}\nâ€¢ Hohe Confidence: {{ $json.processing_statistics.high_confidence }}\n\nğŸ“‹ **Dokumententypen:**\nâ€¢ Rechnungen: {{ $json.processing_statistics.classification_breakdown.invoices }}\nâ€¢ Belege: {{ $json.processing_statistics.classification_breakdown.receipts }}\nâ€¢ VertrÃ¤ge: {{ $json.processing_statistics.classification_breakdown.contracts }}\nâ€¢ Sonstige: {{ $json.processing_statistics.classification_breakdown.general }}\n\nâš ï¸ **Genehmigung erforderlich:** {{ $json.processing_statistics.requires_approval }}\n\nğŸ“ˆ **QualitÃ¤tsmetriken:**\nâ€¢ Ã˜ OCR-Confidence: {{ Math.round($json.quality_metrics.average_ocr_confidence * 100) }}%\nâ€¢ Ã˜ Klassifizierung: {{ Math.round($json.quality_metrics.average_classification_confidence * 100) }}%\nâ€¢ Metadaten-Rate: {{ Math.round($json.quality_metrics.metadata_extraction_rate * 100) }}%\n\nâ–¶ï¸ **NÃ¤chster Schritt:** Teil 2 - Verarbeitung & Validierung"
      },
      "name": "ğŸ“± Team-Benachrichtigung",
      "type": "n8n-nodes-base.signal",
      "typeVersion": 2,
      "position": [2050, 500],
      "credentials": {
        "signalApi": {
          "id": "3",
          "name": "Signal account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "workflow@company.com",
        "toEmail": "document-management@company.com",
        "subject": "Keine neuen Dokumente erfasst - {{ $json.capture_session_id }}",
        "content": "Die automatische Dokumentenerfassung hat keine neuen Dokumente zur Verarbeitung gefunden.\n\n**Session-Details:**\n- Session-ID: {{ $json.capture_session_id }}\n- Erfassung-Zeitpunkt: {{ $json.capture_timestamp }}\n- ÃœberprÃ¼fte Quellen: {{ Object.keys($json.source_summary).length }}\n\n**ÃœberprÃ¼fte Bereiche:**\n- Webhook-Uploads: {{ $json.source_summary.webhook_uploads || 0 }}\n- Directory-Scans: {{ $json.source_summary.directory_scans || 0 }}\n- Scheduled-Batches: {{ $json.source_summary.scheduled_batches || 0 }}\n\n**Abgelehnte Dokumente:** {{ $json.total_rejected || 0 }}\n{% if $json.total_rejected > 0 %}\n**AblehnungsgrÃ¼nde:**\n{% for doc in $json.rejected_documents %}\n- {{ doc.filename }}: {{ doc.validation_error }}\n{% endfor %}\n{% endif %}\n\n**Status:**\n- Alle konfigurierten Quellen erfolgreich Ã¼berprÃ¼ft\n- Keine verarbeitungsrelevanten Dokumente gefunden\n- System lÃ¤uft ordnungsgemÃ¤ÃŸ\n\n**NÃ¤chste ÃœberprÃ¼fung:**\n- Schedule: Automatisch in 15 Minuten\n- Webhook: Jederzeit bei Upload verfÃ¼gbar\n- Manual: Ãœber API-Trigger mÃ¶glich\n\nDies ist eine Routine-Information und erfordert keine weiteren MaÃŸnahmen.",
        "options": {}
      },
      "name": "ğŸ“§ Leerlauf-Info",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [2050, 700],
      "credentials": {
        "smtp": {
          "id": "10",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $node[\"ğŸš€ An Teil 2 weiterleiten\"].json.error !== undefined }}",
              "value2": true
            }
          ]
        }
      },
      "name": "âŒ Fehler aufgetreten?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [2350, 300]
    },
    {
      "parameters": {
        "fromEmail": "workflow@company.com",
        "toEmail": "support@company.com,document-management@company.com",
        "subject": "ğŸš¨ FEHLER: Dokumentenmanagement Teil 1 - {{ $json.capture_session_id }}",
        "content": "Ein kritischer Fehler ist im Dokumentenmanagement-Workflow (Teil 1: Erfassung) aufgetreten.\n\n**ğŸš¨ Fehlerdetails:**\n- Fehler: {{ $node[\"ğŸš€ An Teil 2 weiterleiten\"].json.error?.message || 'Unbekannter Fehler' }}\n- Session-ID: {{ $json.capture_session_id }}\n- Zeitstempel: {{ $now.toISOString() }}\n\n**ğŸ“„ Betroffene Dokumente:**\n- Anzahl verarbeitet: {{ $json.processing_statistics?.total_documents || 'N/A' }}\n- OCR-Erfolgsrate: {{ $json.processing_statistics?.successful_ocr || 0 }}\n- Hohe Confidence: {{ $json.processing_statistics?.high_confidence || 0 }}\n\n**ğŸ“Š QualitÃ¤tsmetriken:**\n- Ã˜ OCR-Confidence: {{ Math.round(($json.quality_metrics?.average_ocr_confidence || 0) * 100) }}%\n- Metadaten-Extraktion: {{ Math.round(($json.quality_metrics?.metadata_extraction_rate || 0) * 100) }}%\n\n**âš ï¸ Auswirkungen:**\n- Dokumentenverarbeitung unterbrochen\n- MÃ¶glicherweise unverarbeitete GeschÃ¤ftsdokumente\n- Compliance-Risiko bei zeitkritischen Dokumenten\n\n**ğŸ”§ SofortmaÃŸnahmen:**\n1. Webhook-Verbindung zu Teil 2 prÃ¼fen\n2. OCR-Engine-Status validieren\n3. Dateisystem-Zugriff Ã¼berprÃ¼fen\n4. n8n-Logs analysieren\n5. Bei kritischen Dokumenten: Manuelle Verarbeitung\n\n**ğŸ“‹ NÃ¤chste Schritte:**\n1. Fehlerursache identifizieren und beheben\n2. OCR/Klassifizierung-Pipeline testen\n3. Verpasste Dokumente nacharbeiten\n4. Monitoring-Alerts optimieren\n\nâ° **Zeitkritisch:** Rechnungen und VertrÃ¤ge umgehend manuell prÃ¼fen!",
        "options": {}
      },
      "name": "ğŸš¨ Kritischer Fehler",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [2650, 200],
      "credentials": {
        "smtp": {
          "id": "10",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "code": "// Protokolliere erfolgreiche Workflow-AusfÃ¼hrung mit umfassendem Audit-Trail\nconst data = $input.item.json;\n\nconst successLog = {\n  timestamp: new Date().toISOString(),\n  workflow: 'Teil1-Erfassung',\n  status: data.batch_completed ? 'documents_processed' : 'no_documents',\n  capture_session_id: data.capture_session_id,\n  processing_statistics: data.processing_statistics || {},\n  quality_metrics: data.quality_metrics || {},\n  performance_metrics: {\n    total_processing_time_ms: data.processing_completed ? \n      Date.now() - new Date(data.capture_timestamp).getTime() : null,\n    documents_per_minute: data.processing_statistics?.total_documents ? \n      (data.processing_statistics.total_documents / ((Date.now() - new Date(data.capture_timestamp).getTime()) / 60000)) : 0,\n    ocr_success_rate: data.processing_statistics?.successful_ocr && data.processing_statistics?.total_documents ?\n      (data.processing_statistics.successful_ocr / data.processing_statistics.total_documents) : 0\n  },\n  compliance_info: {\n    gobd_compliant: true,\n    audit_trail_complete: true,\n    retention_period_years: 10,\n    data_classification: 'business_documents'\n  },\n  next_execution: {\n    scheduled: new Date(Date.now() + 15 * 60 * 1000).toISOString(), // +15 Minuten\n    webhook_available: true,\n    manual_trigger_available: true\n  }\n};\n\nconsole.log('Dokumentenmanagement Teil 1 erfolgreich abgeschlossen:', JSON.stringify(successLog, null, 2));\n\nreturn {\n  json: {\n    ...data,\n    execution_log: successLog,\n    workflow_completed: true,\n    status: 'Teil1-Erfolgreich-Abgeschlossen'\n  }\n};"
      },
      "name": "âœ… Erfolg & Audit-Trail",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2650, 400]
    },
    {
      "parameters": {
        "content": "**ğŸ Workflow-Abschluss & QualitÃ¤tssicherung:**\n\n**âœ… Erfolgreiche Verarbeitung:**\nâ€¢ Weiterleitung an Teil 2 (Verarbeitung)\nâ€¢ Umfassende Statistiken und Metriken\nâ€¢ Team-Benachrichtigung Ã¼ber Slack/Teams\nâ€¢ Audit-Trail fÃ¼r Compliance\n\n**âŒ Keine Dokumente:**\nâ€¢ Information an Document Management Team\nâ€¢ Routine-Ãœberwachung bestÃ¤tigt\nâ€¢ NÃ¤chste PrÃ¼fung geplant\n\n**ğŸš¨ Fehlerbehandlung:**\nâ€¢ Sofortige Alert-Benachrichtigung\nâ€¢ Detaillierte Fehleranalyse\nâ€¢ Compliance-kritische Eskalation\nâ€¢ Recovery-Handlungsempfehlungen\n\n**ğŸ“Š Performance-Monitoring:**\nâ€¢ OCR-Erfolgsraten\nâ€¢ Verarbeitungsgeschwindigkeit\nâ€¢ QualitÃ¤tsmetriken\nâ€¢ Trend-Analyse fÃ¼r Optimierung",
        "width": 350,
        "height": 250,
        "color": 5
      },
      "name": "ğŸ Abschluss-Info",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [2050, 50]
    }
  ],
  "connections": {
    "â° Ordner-Ãœberwachung": {
      "main": [
        [
          {
            "node": "ğŸ“ Scan-Ordner prÃ¼fen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¤ Upload Webhook": {
      "main": [
        [
          {
            "node": "ğŸ”€ Quellen vereinen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Scan-Ordner prÃ¼fen": {
      "main": [
        [
          {
            "node": "ğŸ”€ Quellen vereinen",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ”€ Quellen vereinen": {
      "main": [
        [
          {
            "node": "ğŸ“‹ Dokumente erfassen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ Dokumente erfassen": {
      "main": [
        [
          {
            "node": "âœ… Dokumente gefunden?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœ… Dokumente gefunden?": {
      "main": [
        [
          {
            "node": "ğŸ”„ Dokumente aufteilen",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“§ Leerlauf-Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”„ Dokumente aufteilen": {
      "main": [
        [
          {
            "node": "ğŸ¤– OCR & Klassifizierung",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– OCR & Klassifizierung": {
      "main": [
        [
          {
            "node": "ğŸ“Š Ergebnisse sammeln",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Ergebnisse sammeln": {
      "main": [
        [
          {
            "node": "ğŸ Batch abgeschlossen?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ Batch abgeschlossen?": {
      "main": [
        [
          {
            "node": "ğŸš€ An Teil 2 weiterleiten",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“± Team-Benachrichtigung",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸš€ An Teil 2 weiterleiten": {
      "main": [
        [
          {
            "node": "âŒ Fehler aufgetreten?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Team-Benachrichtigung": {
      "main": [
        [
          {
            "node": "âœ… Erfolg & Audit-Trail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“§ Leerlauf-Info": {
      "main": [
        [
          {
            "node": "âœ… Erfolg & Audit-Trail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âŒ Fehler aufgetreten?": {
      "main": [
        [
          {
            "node": "ğŸš¨ Kritischer Fehler",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âœ… Erfolg & Audit-Trail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {},
  "staticData": {},
  "tags": [
    {
      "createdAt": "2024-12-19T10:00:00.000Z",
      "updatedAt": "2024-12-19T10:00:00.000Z",
      "id": "7",
      "name": "Dokumentenmanagement"
    }
  ],
  "meta": {
    "templateCredsSetupCompleted": true,
    "n8nVersion": "1.101.1"
  },
  "id": "7001",
  "versionId": "v2.0.0"
} 