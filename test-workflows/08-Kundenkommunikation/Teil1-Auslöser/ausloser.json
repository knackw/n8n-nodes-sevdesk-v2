{
  "name": "SevDesk - Kundenkommunikation - Teil 1: AuslÃ¶ser (v2)",
  "nodes": [
    {
      "parameters": {
        "content": "## ğŸ“‹ SevDesk - Kundenkommunikation - Teil 1: AuslÃ¶ser (v2)\n\n**ğŸ¯ Zweck:**\nIntelligente Erkennung von Ereignissen die eine automatische Kundenkommunikation auslÃ¶sen sollen.\n\n**ğŸ“Š Erkannte AuslÃ¶ser:**\nâ€¢ ÃœberfÃ¤llige Rechnungen (>14 Tage)\nâ€¢ ZahlungseingÃ¤nge bestÃ¤tigen\nâ€¢ Geburtstage und JubilÃ¤en\nâ€¢ Projektmeilensteine\nâ€¢ Angebots-Follow-ups\n\n**âš™ï¸ Verarbeitung:**\nâ€¢ TÃ¤gliche automatische PrÃ¼fung\nâ€¢ PrioritÃ¤ts-basierte Klassifizierung\nâ€¢ Duplikat-Vermeidung\nâ€¢ Eskalations-Logik\n\n**ğŸ”„ Workflow-Architektur:**\nTeil 1 â†’ Teil 2 â†’ Teil 3\nAuslÃ¶ser â†’ Erstellung â†’ Versand",
        "height": 350,
        "width": 450,
        "color": 6
      },
      "name": "ğŸ“‹ Workflow-Dokumentation",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [0, 0]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        },
        "triggerOnStartup": false
      },
      "name": "ğŸ•• RegelmÃ¤ÃŸige PrÃ¼fung",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [250, 300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "customer-communication-trigger",
        "options": {
          "responseMode": "responseNode"
        }
      },
      "name": "ğŸŒ Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [250, 500],
      "webhookId": "customer-communication-trigger"
    },
    {
      "parameters": {},
      "name": "ğŸ”€ Trigger vereinen",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [450, 400]
    },
    {
      "parameters": {
        "code": "// Bestimme PrÃ¼fungsparameter basierend auf AuslÃ¶ser\nconst item = $input.item.json;\nlet checkConfig = {};\n\n// Webhook-AuslÃ¶ser (manuell oder extern)\nif (item.headers) {\n  checkConfig = {\n    trigger_source: 'webhook',\n    check_types: item.body?.check_types || ['overdue_invoices', 'payment_confirmations'],\n    priority_filter: item.body?.priority || 'all',\n    customer_filter: item.body?.customer_ids || null\n  };\n}\n// Schedule-AuslÃ¶ser (automatisch)\nelse {\n  checkConfig = {\n    trigger_source: 'scheduled',\n    check_types: ['overdue_invoices', 'payment_confirmations', 'birthdays', 'follow_ups'],\n    priority_filter: 'high',\n    customer_filter: null\n  };\n}\n\nreturn {\n  json: {\n    ...checkConfig,\n    check_timestamp: new Date().toISOString(),\n    workflow_version: 'v2',\n    session_id: `CHECK_${new Date().toISOString().replace(/[:.]/g, '_')}`\n  }\n};"
      },
      "name": "âš™ï¸ PrÃ¼fparameter bestimmen",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 400]
    },
    {
      "parameters": {
        "content": "**ğŸ”§ Trigger-Konfiguration:**\n\n**ğŸ•• Schedule (6h-Intervall):**\nâ€¢ Automatische GeschÃ¤ftszeiten-PrÃ¼fung\nâ€¢ Fokus auf kritische Ereignisse\nâ€¢ Batch-Verarbeitung fÃ¼r Effizienz\n\n**ğŸŒ Webhook (Manuell/Extern):**\nâ€¢ Sofortige Ereignis-Verarbeitung\nâ€¢ Spezifische Kunden-/Event-Filter\nâ€¢ API-Integration fÃ¼r Drittsysteme\n\n**ğŸ”€ Intelligente Vereinigung:**\nâ€¢ Duplikat-Erkennung\nâ€¢ PrioritÃ¤ts-basierte Verarbeitung\nâ€¢ Session-Tracking fÃ¼r Audit-Trail",
        "width": 350,
        "height": 220,
        "color": 7
      },
      "name": "ğŸ”§ Trigger-ErklÃ¤rung",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [250, 50]
    },
    {
      "parameters": {
        "resource": "invoice",
        "operation": "getMany",
        "additionalFields": {
          "status": "200,1000",
          "limit": 500,
          "startDate": "={{ $now.minus({days: 60}).format('YYYY-MM-DD') }}",
          "endDate": "={{ $now.format('YYYY-MM-DD') }}"
        }
      },
      "name": "ğŸ“„ SevDesk - Rechnungen laden",
      "type": "n8n-nodes-sevdesk-v2.sevDesk",
      "typeVersion": 1,
      "position": [950, 300],
      "credentials": {
        "sevDeskApi": {
          "id": "6",
          "name": "SevDesk API"
        }
      }
    },
    {
      "parameters": {
        "resource": "checkAccountTransaction",
        "operation": "getMany",
        "additionalFields": {
          "startDate": "={{ $now.minus({days: 7}).format('YYYY-MM-DD') }}",
          "endDate": "={{ $now.format('YYYY-MM-DD') }}",
          "limit": 200
        }
      },
      "name": "ğŸ’° SevDesk - Zahlungen laden",
      "type": "n8n-nodes-sevdesk-v2.sevDesk",
      "typeVersion": 1,
      "position": [950, 450],
      "credentials": {
        "sevDeskApi": {
          "id": "6",
          "name": "SevDesk API"
        }
      }
    },
    {
      "parameters": {
        "resource": "contact",
        "operation": "getMany",
        "additionalFields": {
          "limit": 1000
        }
      },
      "name": "ğŸ‘¥ SevDesk - Kontakte laden",
      "type": "n8n-nodes-sevdesk-v2.sevDesk",
      "typeVersion": 1,
      "position": [950, 600],
      "credentials": {
        "sevDeskApi": {
          "id": "6",
          "name": "SevDesk API"
        }
      }
    },
    {
      "parameters": {
        "content": "**ğŸ“Š Parallele Datenextraktion:**\n\n**ğŸ“„ Rechnungen (60 Tage):**\nâ€¢ Verschickte und gebuchte Rechnungen\nâ€¢ FÃ¤lligkeitsdaten fÃ¼r ÃœberfÃ¤lligkeits-Check\nâ€¢ Kunden-Zuordnungen\n\n**ğŸ’° Zahlungen (7 Tage):**\nâ€¢ Aktuelle ZahlungseingÃ¤nge\nâ€¢ Zuordnung zu offenen Rechnungen\nâ€¢ BestÃ¤tigungs-relevante Transaktionen\n\n**ğŸ‘¥ Kontakte (VollstÃ¤ndig):**\nâ€¢ Kundenstammdaten\nâ€¢ Geburtstage und wichtige Daten\nâ€¢ KommunikationsprÃ¤ferenzen",
        "width": 320,
        "height": 200,
        "color": 3
      },
      "name": "ğŸ“Š Datenextraktion-Info",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [950, 50]
    },
    {
      "parameters": {},
      "name": "ğŸ“ˆ Daten zusammenfÃ¼hren",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [1250, 450]
    },
    {
      "parameters": {
        "code": "// Analysiere SevDesk-Daten und erkenne Kommunikations-AuslÃ¶ser\nconst config = $node[\"âš™ï¸ PrÃ¼fparameter bestimmen\"].json;\nconst invoices = $node[\"ğŸ“„ SevDesk - Rechnungen laden\"].json || [];\nconst payments = $node[\"ğŸ’° SevDesk - Zahlungen laden\"].json || [];\nconst contacts = $node[\"ğŸ‘¥ SevDesk - Kontakte laden\"].json || [];\n\nconst triggers = [];\nconst today = new Date();\n\n// === 1. ÃœBERFÃ„LLIGE RECHNUNGEN ===\nif (config.check_types.includes('overdue_invoices')) {\n  const overdueInvoices = invoices.filter(invoice => {\n    const dueDate = new Date(invoice.dueDate);\n    const daysOverdue = Math.floor((today - dueDate) / (1000 * 60 * 60 * 24));\n    return daysOverdue > 14; // Mehr als 14 Tage Ã¼berfÃ¤llig\n  });\n  \n  overdueInvoices.forEach(invoice => {\n    const daysOverdue = Math.floor((today - new Date(invoice.dueDate)) / (1000 * 60 * 60 * 24));\n    const contact = contacts.find(c => c.id === invoice.contact?.id);\n    \n    triggers.push({\n      type: 'overdue_invoice',\n      priority: daysOverdue > 30 ? 'critical' : 'high',\n      customer_id: invoice.contact?.id,\n      customer_name: contact?.name || 'Unbekannt',\n      customer_email: contact?.email || null,\n      invoice_id: invoice.id,\n      invoice_number: invoice.invoiceNumber,\n      amount: parseFloat(invoice.sumGross || 0),\n      days_overdue: daysOverdue,\n      due_date: invoice.dueDate,\n      escalation_level: daysOverdue > 45 ? 3 : (daysOverdue > 30 ? 2 : 1),\n      recommended_action: daysOverdue > 45 ? 'final_notice' : 'reminder',\n      metadata: {\n        invoice_date: invoice.invoiceDate,\n        customer_number: contact?.customerNumber,\n        last_reminder: null // WÃ¼rde aus CRM/Historie geladen\n      }\n    });\n  });\n}\n\n// === 2. ZAHLUNGSBESTÃ„TIGUNGEN ===\nif (config.check_types.includes('payment_confirmations')) {\n  payments.forEach(payment => {\n    // Suche zugehÃ¶rige Rechnung basierend auf Betrag und Zeitraum\n    const matchingInvoice = invoices.find(invoice => {\n      const amountMatch = Math.abs(parseFloat(invoice.sumGross) - Math.abs(parseFloat(payment.amount))) < 0.01;\n      const dateMatch = new Date(payment.date) >= new Date(invoice.invoiceDate);\n      return amountMatch && dateMatch;\n    });\n    \n    if (matchingInvoice) {\n      const contact = contacts.find(c => c.id === matchingInvoice.contact?.id);\n      \n      triggers.push({\n        type: 'payment_confirmation',\n        priority: 'medium',\n        customer_id: matchingInvoice.contact?.id,\n        customer_name: contact?.name || 'Unbekannt',\n        customer_email: contact?.email || null,\n        invoice_id: matchingInvoice.id,\n        invoice_number: matchingInvoice.invoiceNumber,\n        payment_amount: Math.abs(parseFloat(payment.amount)),\n        payment_date: payment.date,\n        recommended_action: 'thank_you_confirmation',\n        metadata: {\n          payment_method: payment.paymentMethod || 'Ãœberweisung',\n          transaction_id: payment.id\n        }\n      });\n    }\n  });\n}\n\n// === 3. GEBURTSTAGE UND JUBILÃ„EN ===\nif (config.check_types.includes('birthdays')) {\n  const todayMonth = today.getMonth() + 1;\n  const todayDay = today.getDate();\n  \n  contacts.forEach(contact => {\n    if (contact.birthday) {\n      const birthday = new Date(contact.birthday);\n      if (birthday.getMonth() + 1 === todayMonth && birthday.getDate() === todayDay) {\n        triggers.push({\n          type: 'birthday',\n          priority: 'low',\n          customer_id: contact.id,\n          customer_name: contact.name,\n          customer_email: contact.email,\n          recommended_action: 'birthday_greeting',\n          metadata: {\n            age: today.getFullYear() - birthday.getFullYear(),\n            customer_since: contact.createDate\n          }\n        });\n      }\n    }\n  });\n}\n\n// === 4. ANGEBOTS-FOLLOW-UPS ===\nif (config.check_types.includes('follow_ups')) {\n  // Hier wÃ¼rden Angebote aus SevDesk geladen und auf Follow-up-Bedarf geprÃ¼ft\n  // FÃ¼r Demo: Simuliere basierend auf Kundenkontakt-Datum\n  contacts.forEach(contact => {\n    const lastContact = new Date(contact.updateDate || contact.createDate);\n    const daysSinceContact = Math.floor((today - lastContact) / (1000 * 60 * 60 * 24));\n    \n    // Follow-up nach 30 Tagen ohne Kontakt\n    if (daysSinceContact > 30 && daysSinceContact < 35) {\n      triggers.push({\n        type: 'follow_up',\n        priority: 'medium',\n        customer_id: contact.id,\n        customer_name: contact.name,\n        customer_email: contact.email,\n        days_since_contact: daysSinceContact,\n        recommended_action: 'general_follow_up',\n        metadata: {\n          last_contact_date: lastContact.toISOString().split('T')[0],\n          customer_category: contact.category?.name || 'Standard'\n        }\n      });\n    }\n  });\n}\n\n// PrioritÃ¤ts-Filter anwenden\nlet filteredTriggers = triggers;\nif (config.priority_filter !== 'all') {\n  filteredTriggers = triggers.filter(t => t.priority === config.priority_filter);\n}\n\n// Kunden-Filter anwenden\nif (config.customer_filter) {\n  filteredTriggers = filteredTriggers.filter(t => config.customer_filter.includes(t.customer_id));\n}\n\n// Duplikate entfernen (basierend auf Kunde + Typ)\nconst uniqueTriggers = filteredTriggers.reduce((acc, trigger) => {\n  const key = `${trigger.customer_id}_${trigger.type}`;\n  if (!acc.keys.has(key)) {\n    acc.keys.add(key);\n    acc.triggers.push(trigger);\n  }\n  return acc;\n}, { keys: new Set(), triggers: [] }).triggers;\n\n// Statistiken\nconst stats = {\n  total_triggers_found: triggers.length,\n  after_filtering: uniqueTriggers.length,\n  by_type: {\n    overdue_invoice: uniqueTriggers.filter(t => t.type === 'overdue_invoice').length,\n    payment_confirmation: uniqueTriggers.filter(t => t.type === 'payment_confirmation').length,\n    birthday: uniqueTriggers.filter(t => t.type === 'birthday').length,\n    follow_up: uniqueTriggers.filter(t => t.type === 'follow_up').length\n  },\n  by_priority: {\n    critical: uniqueTriggers.filter(t => t.priority === 'critical').length,\n    high: uniqueTriggers.filter(t => t.priority === 'high').length,\n    medium: uniqueTriggers.filter(t => t.priority === 'medium').length,\n    low: uniqueTriggers.filter(t => t.priority === 'low').length\n  }\n};\n\nreturn {\n  json: {\n    session_id: config.session_id,\n    trigger_source: config.trigger_source,\n    analysis_timestamp: new Date().toISOString(),\n    communication_triggers: uniqueTriggers,\n    statistics: stats,\n    has_triggers: uniqueTriggers.length > 0,\n    next_step: uniqueTriggers.length > 0 ? 'process_triggers' : 'no_action_needed',\n    webhook_url: 'http://localhost:5678/webhook/communication-creation'\n  }\n};"
      },
      "name": "ğŸ¯ AuslÃ¶ser-Analyse",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1550, 450]
    },
    {
      "parameters": {
        "content": "**ğŸ¯ Intelligente AuslÃ¶ser-Erkennung:**\n\n**ğŸ“‹ ÃœberfÃ¤llige Rechnungen:**\nâ€¢ >14 Tage: Standard-Mahnung\nâ€¢ >30 Tage: Intensive Mahnung  \nâ€¢ >45 Tage: Letzte Mahnung\n\n**âœ… ZahlungsbestÃ¤tigungen:**\nâ€¢ Automatische Zahlungszuordnung\nâ€¢ Dankesschreiben-Generierung\nâ€¢ Kundenbindungs-MaÃŸnahmen\n\n**ğŸ‚ Ereignis-Marketing:**\nâ€¢ Geburtstage und JubilÃ¤en\nâ€¢ Kundenjahrestage\nâ€¢ Saisonale AnlÃ¤sse\n\n**ğŸ”„ Follow-up-Management:**\nâ€¢ Automatische Kontaktpflege\nâ€¢ Angebots-Nachfassungen\nâ€¢ Relationship-Management",
        "width": 350,
        "height": 250,
        "color": 4
      },
      "name": "ğŸ¯ Analyse-ErklÃ¤rung",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [1550, 150]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.has_triggers }}",
              "value2": true
            }
          ]
        }
      },
      "name": "ğŸ“¤ AuslÃ¶ser gefunden?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1850, 450]
    },
    {
      "parameters": {
        "url": "={{ $json.webhook_url }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "X-Session-ID",
              "value": "={{ $json.session_id }}"
            },
            {
              "name": "X-Workflow-Source",
              "value": "Teil1-AuslÃ¶ser"
            }
          ]
        },
        "sendBody": true,
        "jsonBody": "={{ JSON.stringify($json, null, 2) }}",
        "options": {
          "timeout": 30000
        }
      },
      "name": "ğŸš€ An Teil 2 weiterleiten",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2150, 350]
    },
    {
      "parameters": {
        "chatId": "customer-communication-alerts",
        "content": "=ğŸ“Š **Kundenkommunikation - AuslÃ¶ser-Analyse**\n\nğŸ” **Session:** {{ $json.session_id }}\nğŸ“… **Zeitpunkt:** {{ $json.analysis_timestamp }}\n\nğŸ“ˆ **Statistiken:**\nâ€¢ AuslÃ¶ser gefunden: {{ $json.statistics.total_triggers_found }}\nâ€¢ Nach Filterung: {{ $json.statistics.after_filtering }}\n\nğŸ¯ **Nach Typ:**\nâ€¢ ÃœberfÃ¤llige Rechnungen: {{ $json.statistics.by_type.overdue_invoice }}\nâ€¢ ZahlungsbestÃ¤tigungen: {{ $json.statistics.by_type.payment_confirmation }}\nâ€¢ Geburtstage: {{ $json.statistics.by_type.birthday }}\nâ€¢ Follow-ups: {{ $json.statistics.by_type.follow_up }}\n\nâš ï¸ **PrioritÃ¤ten:**\nâ€¢ Kritisch: {{ $json.statistics.by_priority.critical }}\nâ€¢ Hoch: {{ $json.statistics.by_priority.high }}\nâ€¢ Mittel: {{ $json.statistics.by_priority.medium }}\nâ€¢ Niedrig: {{ $json.statistics.by_priority.low }}\n\nâ–¶ï¸ **NÃ¤chster Schritt:** Teil 2 - Nachrichtenerstellung"
      },
      "name": "ğŸ“± Slack/Teams Benachrichtigung",
      "type": "n8n-nodes-base.signal",
      "typeVersion": 2,
      "position": [2150, 550],
      "credentials": {
        "signalApi": {
          "id": "3",
          "name": "Signal account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "workflow@company.com",
        "toEmail": "customer-service@company.com,management@company.com",
        "subject": "Keine Kundenkommunikations-AuslÃ¶ser - {{ $json.session_id }}",
        "content": "Die AuslÃ¶ser-Analyse fÃ¼r Kundenkommunikation hat keine Ereignisse erkannt, die eine automatische Kommunikation auslÃ¶sen wÃ¼rden.\n\n**Session-Details:**\n- Session-ID: {{ $json.session_id }}\n- AuslÃ¶ser-Quelle: {{ $json.trigger_source }}\n- Analyse-Zeitpunkt: {{ $json.analysis_timestamp }}\n\n**GeprÃ¼fte Bereiche:**\n- ÃœberfÃ¤llige Rechnungen: âœ“\n- ZahlungsbestÃ¤tigungen: âœ“\n- Geburtstage/JubilÃ¤en: âœ“\n- Follow-up-Bedarf: âœ“\n\n**Ergebnis:**\n- Keine kritischen oder zeitkritischen Kommunikations-Ereignisse erkannt\n- Alle Kunden scheinen aktuell zufriedenstellend betreut\n- Keine sofortigen MaÃŸnahmen erforderlich\n\n**Empfehlung:**\n- NÃ¤chste automatische PrÃ¼fung in 6 Stunden\n- Bei Bedarf manuelle AuslÃ¶sung Ã¼ber Webhook mÃ¶glich\n- Proaktive Kundenpflege-MaÃŸnahmen kÃ¶nnen optional durchgefÃ¼hrt werden\n\nDies ist eine Routine-Information und erfordert keine weiteren MaÃŸnahmen.",
        "options": {}
      },
      "name": "ğŸ“§ Leerlauf-Benachrichtigung",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [2150, 650],
      "credentials": {
        "smtp": {
          "id": "10",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "content": "**ğŸ“¤ Ergebnis-Verarbeitung:**\n\n**âœ… AuslÃ¶ser gefunden:**\nâ€¢ Weiterleitung an Teil 2 (Nachrichtenerstellung)\nâ€¢ Automatische Priorisierung\nâ€¢ Session-Tracking fÃ¼r Audit-Trail\nâ€¢ Team-Benachrichtigung Ã¼ber Slack/Teams\n\n**âŒ Keine AuslÃ¶ser:**\nâ€¢ Information an Customer Service Team\nâ€¢ Dokumentation der erfolgreichen PrÃ¼fung\nâ€¢ Kein weiterer Handlungsbedarf\nâ€¢ NÃ¤chste PrÃ¼fung in 6 Stunden\n\n**ğŸ“Š Monitoring:**\nâ€¢ VollstÃ¤ndige Statistiken\nâ€¢ Trend-Analyse fÃ¼r Optimierung\nâ€¢ Performance-Tracking",
        "width": 350,
        "height": 220,
        "color": 5
      },
      "name": "ğŸ“¤ Verarbeitung-Info",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 2,
      "position": [1850, 150]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $node[\"ğŸš€ An Teil 2 weiterleiten\"].json.error !== undefined }}",
              "value2": true
            }
          ]
        }
      },
      "name": "âŒ Fehler aufgetreten?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [2450, 350]
    },
    {
      "parameters": {
        "fromEmail": "workflow@company.com",
        "toEmail": "support@company.com,management@company.com",
        "subject": "ğŸš¨ FEHLER: Kundenkommunikation Teil 1 - {{ $json.session_id }}",
        "content": "Ein kritischer Fehler ist im Kundenkommunikation-Workflow (Teil 1: AuslÃ¶ser) aufgetreten.\n\n**ğŸš¨ Fehlerdetails:**\n- Fehler: {{ $node[\"ğŸš€ An Teil 2 weiterleiten\"].json.error?.message || 'Unbekannter Fehler' }}\n- Session-ID: {{ $json.session_id }}\n- Zeitstempel: {{ $now.toISOString() }}\n- AuslÃ¶ser-Quelle: {{ $json.trigger_source }}\n\n**ğŸ“Š Gefundene AuslÃ¶ser:**\n- Anzahl AuslÃ¶ser: {{ $json.statistics?.total_triggers_found || 'N/A' }}\n- Kritische Ereignisse: {{ $json.statistics?.by_priority?.critical || 0 }}\n- ÃœberfÃ¤llige Rechnungen: {{ $json.statistics?.by_type?.overdue_invoice || 0 }}\n\n**âš ï¸ Auswirkungen:**\n- Automatische Kundenkommunikation unterbrochen\n- MÃ¶glicherweise verzÃ¶gerte Mahnungen/BestÃ¤tigungen\n- Manuelle Intervention erforderlich\n\n**ğŸ”§ SofortmaÃŸnahmen:**\n1. Webhook-Verbindung zu Teil 2 prÃ¼fen\n2. SevDesk API-Verbindung validieren\n3. n8n-Logs auf weitere Details prÃ¼fen\n4. Bei kritischen AuslÃ¶sern: Manuelle Bearbeitung\n\n**ğŸ“‹ NÃ¤chste Schritte:**\n1. Fehlerursache identifizieren und beheben\n2. Workflow-Test durchfÃ¼hren\n3. Verpasste Kommunikation nacharbeiten\n4. Monitoring verstÃ¤rken\n\nâ° **Zeitkritisch:** Bei Ã¼berfÃ¤lligen Rechnungen umgehend handeln!",
        "options": {}
      },
      "name": "ğŸš¨ Fehler-Benachrichtigung",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [2750, 250],
      "credentials": {
        "smtp": {
          "id": "10",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "code": "// Protokolliere erfolgreiche Workflow-AusfÃ¼hrung\nconst data = $input.item.json;\n\nconst successLog = {\n  timestamp: new Date().toISOString(),\n  workflow: 'Teil1-AuslÃ¶ser',\n  status: data.has_triggers ? 'triggers_found' : 'no_triggers',\n  session_id: data.session_id,\n  trigger_source: data.trigger_source,\n  statistics: data.statistics,\n  processing_time_ms: Date.now() - new Date(data.analysis_timestamp).getTime(),\n  next_execution: new Date(Date.now() + 6 * 60 * 60 * 1000).toISOString(), // +6 Stunden\n  audit_trail: {\n    data_sources_accessed: ['invoices', 'payments', 'contacts'],\n    filters_applied: data.trigger_source === 'scheduled' ? 'high_priority_only' : 'custom',\n    triggers_processed: data.communication_triggers?.length || 0,\n    escalated_to_part2: data.has_triggers\n  }\n};\n\nconsole.log('Kundenkommunikation Teil 1 erfolgreich abgeschlossen:', JSON.stringify(successLog, null, 2));\n\nreturn {\n  json: {\n    ...data,\n    execution_log: successLog,\n    workflow_completed: true,\n    status: 'Teil1-Erfolgreich-Abgeschlossen'\n  }\n};"
      },
      "name": "âœ… Erfolg protokollieren",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2750, 450]
    }
  ],
  "connections": {
    "ğŸ•• RegelmÃ¤ÃŸige PrÃ¼fung": {
      "main": [
        [
          {
            "node": "ğŸ”€ Trigger vereinen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸŒ Webhook Trigger": {
      "main": [
        [
          {
            "node": "ğŸ”€ Trigger vereinen",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ”€ Trigger vereinen": {
      "main": [
        [
          {
            "node": "âš™ï¸ PrÃ¼fparameter bestimmen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš™ï¸ PrÃ¼fparameter bestimmen": {
      "main": [
        [
          {
            "node": "ğŸ“„ SevDesk - Rechnungen laden",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ’° SevDesk - Zahlungen laden",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ‘¥ SevDesk - Kontakte laden",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“„ SevDesk - Rechnungen laden": {
      "main": [
        [
          {
            "node": "ğŸ“ˆ Daten zusammenfÃ¼hren",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’° SevDesk - Zahlungen laden": {
      "main": [
        [
          {
            "node": "ğŸ“ˆ Daten zusammenfÃ¼hren",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ‘¥ SevDesk - Kontakte laden": {
      "main": [
        [
          {
            "node": "ğŸ“ˆ Daten zusammenfÃ¼hren",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "ğŸ“ˆ Daten zusammenfÃ¼hren": {
      "main": [
        [
          {
            "node": "ğŸ¯ AuslÃ¶ser-Analyse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ AuslÃ¶ser-Analyse": {
      "main": [
        [
          {
            "node": "ğŸ“¤ AuslÃ¶ser gefunden?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¤ AuslÃ¶ser gefunden?": {
      "main": [
        [
          {
            "node": "ğŸš€ An Teil 2 weiterleiten",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“± Slack/Teams Benachrichtigung",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“§ Leerlauf-Benachrichtigung",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸš€ An Teil 2 weiterleiten": {
      "main": [
        [
          {
            "node": "âŒ Fehler aufgetreten?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Slack/Teams Benachrichtigung": {
      "main": [
        [
          {
            "node": "âœ… Erfolg protokollieren",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“§ Leerlauf-Benachrichtigung": {
      "main": [
        [
          {
            "node": "âœ… Erfolg protokollieren",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âŒ Fehler aufgetreten?": {
      "main": [
        [
          {
            "node": "ğŸš¨ Fehler-Benachrichtigung",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âœ… Erfolg protokollieren",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {},
  "staticData": {},
  "tags": [
    {
      "createdAt": "2024-12-19T10:00:00.000Z",
      "updatedAt": "2024-12-19T10:00:00.000Z",
      "id": "8",
      "name": "Kundenkommunikation"
    }
  ],
  "meta": {
    "templateCredsSetupCompleted": true,
    "n8nVersion": "1.101.1"
  },
  "id": "8001",
  "versionId": "v2.0.0"
} 