# SevDesk Node Dokumentation

## Inhaltsverzeichnis

1. [Ãœbersicht](#Ã¼bersicht)
2. [Installation](#installation)
3. [Konfiguration](#konfiguration)
4. [Ressourcen](#ressourcen)
5. [Operationen](#operationen)
6. [Erweiterte Funktionen](#erweiterte-funktionen)
7. [Beispiele](#beispiele)
8. [Fehlerbehebung](#fehlerbehebung)
9. [API-Referenz](#api-referenz)
10. [Best Practices](#best-practices)
11. [Entwicklung](#entwicklung)

## Ãœbersicht

Der SevDesk Node fÃ¼r n8n bietet eine direkte Integration mit der SevDesk Buchhaltungsplattform. SevDesk ist eine beliebte deutsche Buchhaltungssoftware, die eine robuste API fÃ¼r Automatisierung und Integration bietet.

### Hauptfunktionen

- **VollstÃ¤ndige CRUD-Operationen**: Erstellen, lesen, aktualisieren und lÃ¶schen fÃ¼r alle wichtigen EntitÃ¤ten
- **API v2 UnterstÃ¼tzung**: Neueste API-Version mit RÃ¼ckwÃ¤rtskompatibilitÃ¤t
- **Umfassende Filterung**: Erweiterte Such- und Filterfunktionen
- **Dateiverwaltung**: Upload und Download von Dokumenten
- **Batch-Operationen**: Effiziente Verarbeitung mehrerer Elemente
- **Fehlerbehandlung**: Robuste Fehlerbehandlung mit detailliertem Feedback
- **Direkte API-Integration**: Keine externen AbhÃ¤ngigkeiten oder Zwischenschichten
- **Einfache Konfiguration**: Nur API-SchlÃ¼ssel und Version erforderlich

### UnterstÃ¼tzte Ressourcen

| Ressource | Status | Beschreibung |
|-----------|--------|--------------|
| Kontakte | âœ… VollstÃ¤ndig | Kontaktverwaltung mit Adressen und benutzerdefinierten Feldern |
| Rechnungen | âœ… VollstÃ¤ndig | VollstÃ¤ndiger Rechnungslebenszyklus einschlieÃŸlich PDF-Generierung |
| AuftrÃ¤ge | âœ… VollstÃ¤ndig | Auftragsverwaltung mit Positionen |
| Belege | âœ… VollstÃ¤ndig | Belegverwaltung mit DateianhÃ¤ngen |
| Artikel | âœ… VollstÃ¤ndig | Lagerverwaltung mit Bestandsverfolgung |
| Bankwesen | âœ… VollstÃ¤ndig | Bankkonten und Transaktionen |
| Tags | âœ… VollstÃ¤ndig | Flexibles Tagging-System |
| Berichte | âœ… VollstÃ¤ndig | PDF-Berichtsgenerierung |
| Gutschriften | ğŸ”„ In Bearbeitung | Gutschriftenverwaltung |
| Exporte | ğŸ”„ In Bearbeitung | Datenexport-FunktionalitÃ¤t |

## Installation

### Ãœber n8n Community Nodes

```bash
npm install n8n-nodes-sevdesk-v2
```

### Manuelle Installation

1. Repository klonen
2. Dependencies installieren: `npm install`
3. Build erstellen: `npm run build`
4. Node verlinken: `npm link`

## Konfiguration

### SevDesk API-Credentials

Die SevDesk-Node benÃ¶tigt nur zwei einfache Konfigurationsparameter:

1. **API Key**: Ihr SevDesk API-SchlÃ¼ssel
2. **API Version**: v2 (empfohlen) oder v1 (Legacy)

#### API-SchlÃ¼ssel erstellen

1. Melden Sie sich bei SevDesk an
2. Gehen Sie zu **Einstellungen** > **Benutzerverwaltung** > **API**
3. Erstellen Sie einen neuen API-SchlÃ¼ssel
4. Konfigurieren Sie die Credentials in n8n

## Erweiterte Funktionen

### Bulk-Operationen

FÃ¼r effiziente Verarbeitung groÃŸer Datenmengen unterstÃ¼tzt der Node Batch-Operationen:

```javascript
// Mehrere Kontakte gleichzeitig erstellen
const contacts = [
  { name: "Kunde 1", customerNumber: "K001" },
  { name: "Kunde 2", customerNumber: "K002" },
  { name: "Kunde 3", customerNumber: "K003" }
];

// Batch-Verarbeitung mit Fehlerbehandlung
for (const contact of contacts) {
  try {
    await sevDeskApi.createContact(contact);
  } catch (error) {
    console.error(`Fehler beim Erstellen von ${contact.name}:`, error);
  }
}
```

### Datei-Upload/Download

Der SevDesk Node unterstÃ¼tzt den Upload und Download von Dokumenten:

```javascript
// Beleg mit Anhang hochladen
const voucher = {
  date: "2024-01-15",
  supplier: { id: "123" },
  voucherType: "VOU",
  status: "50",
  attachment: {
    filename: "rechnung.pdf",
    content: base64Content
  }
};
```

### Fehlerbehandlung

Umfassende Fehlerbehandlung mit automatischen Retry-Mechanismen:

```javascript
// Automatische Wiederholung bei temporÃ¤ren Fehlern
const maxRetries = 3;
let attempt = 0;

while (attempt < maxRetries) {
  try {
    const result = await sevDeskApi.createInvoice(invoiceData);
    return result;
  } catch (error) {
    attempt++;
    if (attempt >= maxRetries) throw error;
    await sleep(1000 * attempt); // Exponential backoff
  }
}
```

## Beispiele

### Einfacher Rechnungs-Workflow

```javascript
// 1. Neuen Kontakt erstellen
const contact = await sevDesk.contact.create({
  name: "Max Mustermann",
  customerNumber: "CUST-001",
  category: { id: "3" }
});

// 2. Artikel erstellen
const part = await sevDesk.part.create({
  name: "Beratungsleistung",
  partNumber: "BER-001",
  price: 100.00,
  unity: { id: "1" }
});

// 3. Rechnung erstellen
const invoice = await sevDesk.invoice.create({
  contact: { id: contact.id },
  invoiceDate: new Date().toISOString().split('T')[0],
  status: "100",
  invoiceType: "RE"
});

// 4. Rechnungsposition hinzufÃ¼gen
const invoicePos = await sevDesk.invoicePos.create({
  invoice: { id: invoice.id },
  part: { id: part.id },
  quantity: 1,
  price: 100.00
});

// 5. Rechnung finalisieren und versenden
const finalInvoice = await sevDesk.invoice.sendBy({
  id: invoice.id,
  sendType: "VPR" // Per E-Mail
});
```

### Belegerkennung und -verarbeitung

```javascript
// PDF-Beleg aus E-Mail-Anhang verarbeiten
const attachment = $input.item.binary.attachment;

// Beleg in SevDesk erstellen
const voucher = await sevDesk.voucher.create({
  date: extractedData.date,
  supplier: { id: supplierId },
  sumNet: extractedData.netAmount,
  sumTax: extractedData.taxAmount,
  sumGross: extractedData.grossAmount,
  voucherType: "VOU",
  status: "50"
});

// PDF-Datei anhÃ¤ngen
const document = await sevDesk.voucherPos.createDocument({
  voucher: { id: voucher.id },
  filename: attachment.fileName,
  content: attachment.data
});
```

### Mahnwesen-Automation

```javascript
// ÃœberfÃ¤llige Rechnungen finden
const overdueInvoices = await sevDesk.invoice.getMany({
  'status[lt]': '200', // Nicht bezahlt
  'dueDate[lt]': new Date().toISOString().split('T')[0]
});

// Mahnungen erstellen
for (const invoice of overdueInvoices) {
  const daysOverdue = calculateDaysOverdue(invoice.dueDate);
  
  if (daysOverdue > 30) {
    // 3. Mahnung
    await createDunningNotice(invoice, 3);
  } else if (daysOverdue > 14) {
    // 2. Mahnung
    await createDunningNotice(invoice, 2);
  } else if (daysOverdue > 7) {
    // 1. Mahnung
    await createDunningNotice(invoice, 1);
  }
}
```

## API-Referenz

### Standard-Operationen

Alle Ressourcen unterstÃ¼tzen die folgenden Basis-Operationen:

- **Create**: Neue EntitÃ¤t erstellen
- **Get**: Einzelne EntitÃ¤t abrufen
- **Get Many**: Multiple EntitÃ¤ten abrufen (mit Filterung)
- **Update**: EntitÃ¤t aktualisieren
- **Delete**: EntitÃ¤t lÃ¶schen

### Erweiterte Operationen

ZusÃ¤tzliche Operationen je nach Ressource:

- **Send By Email**: Dokumente per E-Mail versenden
- **Render PDF**: PDF-Dokumente generieren
- **Book**: Buchungen durchfÃ¼hren
- **Cancel**: Stornierungen
- **Copy**: EntitÃ¤ten duplizieren

### Filter-Parameter

Umfassende Filteroptionen fÃ¼r Get Many-Operationen:

```javascript
// Erweiterte Filterung
const invoices = await sevDesk.invoice.getMany({
  'contact.id': '123',                    // Spezifischer Kontakt
  'invoiceDate[gte]': '2024-01-01',      // Datum grÃ¶ÃŸer gleich
  'invoiceDate[lte]': '2024-12-31',      // Datum kleiner gleich
  'status[in]': ['100', '200'],          // Status in Liste
  'sumGross[gt]': '1000',                // Betrag grÃ¶ÃŸer als
  'orderBy': 'invoiceDate',              // Sortierung
  'orderType': 'DESC',                   // Sortierreihenfolge
  'limit': '50',                         // Anzahl Ergebnisse
  'offset': '0'                          // Offset fÃ¼r Pagination
});
```

## Best Practices

### Performance-Optimierung

1. **Batch-Verarbeitung**: Verwenden Sie Schleifen fÃ¼r groÃŸe Datenmengen
2. **Caching**: Vermeiden Sie wiederholte API-Aufrufe fÃ¼r statische Daten
3. **Pagination**: Nutzen Sie limit/offset fÃ¼r groÃŸe DatensÃ¤tze
4. **Rate Limiting**: Beachten Sie SevDesk API-Limits

### Fehlerbehandlung

1. **Retry-Mechanismen**: Implementieren Sie Wiederholungslogik
2. **Validierung**: PrÃ¼fen Sie Eingabedaten vor API-Aufrufen
3. **Logging**: Protokollieren Sie Fehler fÃ¼r Debugging
4. **Fallback**: Definieren Sie Fallback-Strategien

### Sicherheit

1. **API-Key-Schutz**: Verwenden Sie n8n Credentials fÃ¼r sichere Speicherung
2. **Datenvalidierung**: Validieren Sie alle Eingaben
3. **Minimal Privileges**: Verwenden Sie API-Keys mit minimalen Berechtigungen
4. **Audit Trail**: Protokollieren Sie alle Ã„nderungen

## Entwicklung

### Setup fÃ¼r Entwickler

```bash
# Repository klonen
git clone <repository-url>
cd n8n-nodes-sevdesk-v2

# Dependencies installieren
npm install

# TypeScript kompilieren
npm run build

# Tests ausfÃ¼hren
npm test

# Docker-Entwicklungsumgebung starten
npm start
```

### Architektur

```
nodes/
â”œâ”€â”€ SevDesk/
â”‚   â”œâ”€â”€ SevDesk.node.ts              # Haupt-Node-Implementation
â”‚   â”œâ”€â”€ SevDeskResourceManager.ts    # API-Management
â”‚   â””â”€â”€ descriptions/                # Ressourcen-Beschreibungen
â”‚       â”œâ”€â”€ ContactDescription.ts
â”‚       â”œâ”€â”€ InvoiceDescription.ts
â”‚       â””â”€â”€ ...
credentials/
â””â”€â”€ SevDeskApi.credentials.ts        # Credential-Definition
```

### Testing

```bash
# Unit Tests
npm run test:unit

# Integration Tests
npm run test:integration

# E2E Tests
npm run test:e2e

# Coverage Report
npm run test:coverage
```

### Beitragen

1. Fork das Repository
2. Feature-Branch erstellen
3. Tests hinzufÃ¼gen
4. Pull Request erstellen

## Fehlerbehebung

### HÃ¤ufige Probleme

| Problem | LÃ¶sung |
|---------|--------|
| "Unauthorized" | API-Key Ã¼berprÃ¼fen |
| "Rate Limit" | Anfragen reduzieren/verzÃ¶gern |
| "Not Found" | Ressourcen-ID Ã¼berprÃ¼fen |
| Timeout | Netzwerkverbindung prÃ¼fen |

### Debug-Modus

```javascript
// Debugging aktivieren
const sevDesk = new SevDeskResourceManager(credentials, {
  debug: true,
  logRequests: true,
  logResponses: true
});
```

### Support

- **GitHub Issues**: FÃ¼r Bugs und Feature-Requests
- **Community Forum**: FÃ¼r allgemeine Fragen
- **SevDesk Docs**: FÃ¼r API-spezifische Fragen